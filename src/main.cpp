#include <Arduino.h>
#include <WiFi.h>
#include <HTTPClient.h>
#include <ArduinoJson.h>
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SH110X.h>
#include <Adafruit_MPU6050.h>
#include <Adafruit_Sensor.h>
#include <WiFiManager.h> 

// Define API Key and other constants
const char* API_KEY = "AIzaSyCaepy-tFgUFmhAYcL1oXEGoynCdjMxtSo";
const char* MAX_TOKENS = "150";

// Define OLED display dimensions
#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64

// Create SH1106 display object
Adafruit_SH1106G display = Adafruit_SH1106G(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire);

// MPU6050 object for accelerometer
Adafruit_MPU6050 mpu;

// Keyboard layout
char keyboard[4][10] = {
  {'Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P'},
  {'A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L', '?'},
  {'Z', 'X', 'C', 'V', 'B', 'N', 'M', ' ', '.', '/'}, // ' ' represents space key
  {'1', '2', '3', '4', '5', '6', '7', '8', '9', '0'}
};

// Variables to store input text
String inputText = "";  
String aiResponse = "";  // Store AI response for scrolling

int cursorX = 0;  
int cursorY = 0;  
int previousX = 0;
int previousY = 0;
int scrollOffset = 0;
int frame = 0;

// Button pin and states
#define BUTTON_PIN_SELECT 23
#define BUTTON_PIN_SEND 12

bool buttonHeldSelect = false;
bool buttonHeldSend = false;
bool responseDisplayed = false;
bool typingStarted = false;

#define FRAME_DELAY (42)
#define FRAME_WIDTH (64)
#define FRAME_HEIGHT (64)
#define FRAME_COUNT (sizeof(frames) / sizeof(frames[0]))

const byte PROGMEM frames[][512] = {
  {7,192,0,0,3,240,0,0,31,240,0,0,7,248,0,0,63,248,0,0,31,254,0,0,120,60,0,0,28,14,0,0,112,14,0,0,56,7,0,0,224,14,0,0,48,3,0,0,224,6,0,0,112,3,0,0,224,6,0,0,112,3,128,0,224,6,0,0,112,3,128,0,224,14,0,0,48,3,0,0,112,14,0,0,56,7,0,0,112,28,0,0,60,15,0,0,60,124,0,0,31,62,0,0,31,254,0,0,15,252,0,0,15,231,0,0,7,240,0,0,0,3,128,0,7,0,0,0,0,1,192,0,14,0,0,0,0,0,224,0,14,0,0,0,0,0,112,0,30,0,0,0,0,0,56,7,252,0,0,0,0,0,28,63,252,0,0,0,0,0,14,127,254,0,0,0,0,0,7,240,15,128,0,0,0,0,3,192,3,192,0,0,0,0,3,128,1,192,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,12,0,0,48,0,0,0,0,28,0,0,56,0,128,0,0,28,0,0,56,7,240,0,0,28,0,0,56,31,252,0,0,28,0,0,56,60,60,0,0,28,0,0,56,56,14,0,0,28,0,0,63,240,6,0,0,12,0,0,63,240,7,0,0,14,0,0,113,224,7,0,0,14,0,0,112,96,7,0,0,7,0,0,224,112,7,0,0,15,128,1,192,112,7,0,0,31,192,3,192,120,14,0,0,61,240,15,128,60,28,0,0,120,127,254,0,31,252,0,1,240,63,255,0,15,240,15,227,192,7,231,0,1,192,31,255,128,0,3,128,0,0,60,63,0,0,3,128,0,0,112,30,0,0,1,192,0,0,96,14,0,0,1,192,0,0,224,14,0,0,0,255,0,0,224,6,0,0,0,255,192,0,224,6,0,0,1,227,224,0,224,6,0,0,3,192,224,0,224,14,0,0,3,128,112,0,112,30,0,0,7,0,48,0,120,60,0,0,7,0,48,0,63,248,0,0,7,0,48,0,31,240,0,0,7,0,48,0,3,192,0,0,3,0,112,0,0,0,0,0,3,128,112,0,0,0,0,0,3,192,224,0,0,0,0,0,1,255,192,0,0,0,0,0,0,255,128,0,0,0,0,0,0,62,0,0},
  {7,192,0,0,3,240,0,0,31,240,0,0,7,248,0,0,63,248,0,0,31,254,0,0,120,60,0,0,28,14,0,0,112,14,0,0,56,7,0,0,224,14,0,0,48,3,0,0,224,6,0,0,112,3,0,0,224,6,0,0,112,3,128,0,224,6,0,0,112,3,128,0,224,14,0,0,48,3,0,0,112,14,0,0,56,7,0,0,112,28,0,0,60,15,0,0,60,124,0,0,31,62,0,0,31,254,0,0,15,252,0,0,15,231,0,0,7,240,0,0,0,3,128,0,7,0,0,0,0,1,192,0,14,0,0,0,0,0,224,0,14,0,0,0,0,0,112,0,30,0,0,0,0,0,56,7,252,0,0,0,0,0,28,63,252,0,0,0,0,0,14,127,254,0,0,0,0,0,7,240,15,128,0,0,0,0,3,192,3,192,0,0,0,0,3,128,1,192,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,12,0,0,48,0,0,0,0,28,0,0,56,0,128,0,0,28,0,0,56,7,240,0,0,28,0,0,56,31,252,0,0,28,0,0,56,60,60,0,0,28,0,0,56,56,14,0,0,28,0,0,63,240,6,0,0,12,0,0,63,240,7,0,0,14,0,0,113,224,7,0,0,14,0,0,112,96,7,0,0,7,0,0,224,112,7,0,0,15,128,1,192,112,7,0,0,31,192,3,192,120,14,0,0,61,240,15,128,60,28,0,0,120,127,254,0,31,252,0,1,240,63,255,0,15,240,15,227,192,7,231,0,1,192,31,255,128,0,3,128,0,0,60,63,0,0,3,128,0,0,112,30,0,0,1,192,0,0,96,14,0,0,1,192,0,0,224,14,0,0,0,255,0,0,224,6,0,0,0,255,192,0,224,6,0,0,1,227,224,0,224,6,0,0,3,192,224,0,224,14,0,0,3,128,112,0,112,30,0,0,7,0,48,0,120,60,0,0,7,0,48,0,63,248,0,0,7,0,48,0,31,240,0,0,7,0,48,0,3,192,0,0,3,0,112,0,0,0,0,0,3,128,112,0,0,0,0,0,3,192,224,0,0,0,0,0,1,255,192,0,0,0,0,0,0,255,128,0,0,0,0,0,0,62,0,0},
  {7,192,0,0,3,240,0,0,31,240,0,0,7,248,0,0,63,248,0,0,31,254,0,0,120,60,0,0,28,14,0,0,112,14,0,0,56,7,0,0,224,14,0,0,48,3,0,0,224,6,0,0,112,3,0,0,224,6,0,0,112,3,128,0,224,6,0,0,112,3,128,0,224,14,0,0,48,3,0,0,112,14,0,0,56,7,0,0,112,28,0,0,60,15,0,0,60,124,0,0,31,62,0,0,31,254,0,0,15,252,0,0,15,231,0,0,7,240,0,0,0,3,128,0,7,0,0,0,0,1,192,0,14,0,0,0,0,0,224,0,14,0,0,0,0,0,112,0,30,0,0,0,0,0,56,7,252,0,0,0,0,0,28,63,252,0,0,0,0,0,14,127,254,0,0,0,0,0,7,240,15,128,0,0,0,0,3,192,3,192,0,0,0,0,3,128,1,192,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,12,0,0,48,0,0,0,0,28,0,0,56,0,128,0,0,28,0,0,56,7,240,0,0,28,0,0,56,31,252,0,0,28,0,0,56,60,60,0,0,28,0,0,56,56,14,0,0,28,0,0,63,240,6,0,0,12,0,0,63,240,7,0,0,14,0,0,113,224,7,0,0,14,0,0,112,96,7,0,0,7,0,0,224,112,7,0,0,15,128,1,192,112,7,0,0,31,192,3,192,120,14,0,0,61,240,15,128,60,28,0,0,120,127,254,0,31,252,0,1,240,63,255,0,15,240,15,227,192,7,231,0,1,192,31,255,128,0,3,128,0,0,60,63,0,0,3,128,0,0,112,30,0,0,1,192,0,0,96,14,0,0,1,192,0,0,224,14,0,0,0,255,0,0,224,6,0,0,0,255,192,0,224,6,0,0,1,227,224,0,224,6,0,0,3,192,224,0,224,14,0,0,3,128,112,0,112,30,0,0,7,0,48,0,120,60,0,0,7,0,48,0,63,248,0,0,7,0,48,0,31,240,0,0,7,0,48,0,3,192,0,0,3,0,112,0,0,0,0,0,3,128,112,0,0,0,0,0,3,192,224,0,0,0,0,0,1,255,192,0,0,0,0,0,0,255,128,0,0,0,0,0,0,62,0,0},
  {7,192,0,0,3,240,0,0,31,240,0,0,7,248,0,0,63,248,0,0,31,254,0,0,120,60,0,0,28,14,0,0,112,14,0,0,56,7,0,0,224,14,0,0,48,3,0,0,224,6,0,0,112,3,0,0,224,6,0,0,112,3,128,0,224,6,0,0,112,3,128,0,224,14,0,0,48,3,0,0,112,14,0,0,56,7,0,0,112,28,0,0,60,15,0,0,60,124,0,0,31,62,0,0,31,254,0,0,15,252,0,0,15,231,0,0,7,240,0,0,0,3,128,0,7,0,0,0,0,1,192,0,14,0,0,0,0,0,224,0,14,0,0,0,0,0,112,0,30,0,0,0,0,0,56,7,252,0,0,0,0,0,28,63,252,0,0,0,0,0,14,127,254,0,0,0,0,0,7,240,15,128,0,0,0,0,3,192,3,192,0,0,0,0,3,128,1,192,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,12,0,0,48,0,0,0,0,28,0,0,56,0,128,0,0,28,0,0,56,7,240,0,0,28,0,0,56,31,252,0,0,28,0,0,56,60,60,0,0,28,0,0,56,56,14,0,0,28,0,0,63,240,6,0,0,12,0,0,63,240,7,0,0,14,0,0,113,224,7,0,0,14,0,0,112,96,7,0,0,7,0,0,224,112,7,0,0,15,128,1,192,112,7,0,0,31,192,3,192,120,14,0,0,61,240,15,128,60,28,0,0,120,127,254,0,31,252,0,1,240,63,255,0,15,240,15,227,192,7,231,0,1,192,31,255,128,0,3,128,0,0,60,63,0,0,3,128,0,0,112,30,0,0,1,192,0,0,96,14,0,0,1,192,0,0,224,14,0,0,0,255,0,0,224,6,0,0,0,255,192,0,224,6,0,0,1,227,224,0,224,6,0,0,3,192,224,0,224,14,0,0,3,128,112,0,112,30,0,0,7,0,48,0,120,60,0,0,7,0,48,0,63,248,0,0,7,0,48,0,31,240,0,0,7,0,48,0,3,192,0,0,3,0,112,0,0,0,0,0,3,128,112,0,0,0,0,0,3,192,224,0,0,0,0,0,1,255,192,0,0,0,0,0,0,255,128,0,0,0,0,0,0,62,0,0},
  {7,192,0,0,0,224,0,0,15,240,0,0,7,248,0,0,63,252,0,0,15,254,0,0,56,28,0,0,30,14,0,0,112,14,0,0,56,7,0,0,96,14,0,0,56,3,0,0,224,6,0,0,48,3,128,0,224,7,0,0,48,3,128,0,224,6,0,0,48,3,128,0,96,6,0,0,48,3,128,0,112,14,0,0,56,7,0,0,120,28,0,0,28,7,0,0,62,124,0,0,30,30,0,0,31,254,0,0,15,252,0,0,15,231,0,0,7,248,0,0,0,3,128,0,7,64,0,0,0,1,192,0,14,0,0,0,0,0,224,0,14,0,0,0,0,0,112,0,14,0,0,0,0,0,56,7,252,0,0,0,0,0,28,63,252,0,0,0,0,0,14,127,254,0,0,0,0,0,7,240,15,128,0,0,0,0,3,192,3,192,0,0,0,0,3,128,1,192,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,12,0,0,48,0,0,0,0,28,0,0,56,0,0,0,0,28,0,0,56,7,240,0,0,28,0,0,56,31,248,0,0,28,0,0,56,60,60,0,0,28,0,0,56,56,14,0,0,28,0,0,63,240,14,0,0,12,0,0,63,240,7,0,0,14,0,0,113,224,7,0,0,14,0,0,112,96,7,0,0,7,0,0,224,96,7,0,0,15,128,1,192,112,7,0,0,31,192,3,192,112,14,0,0,61,240,15,128,60,28,0,0,248,127,254,0,31,252,3,129,224,63,254,0,15,240,15,243,192,7,231,0,3,192,63,255,128,0,3,0,0,0,56,63,0,0,3,128,0,0,112,30,0,0,1,192,0,0,224,14,0,0,1,192,0,0,224,14,0,0,0,255,0,0,224,6,0,0,0,255,192,0,224,6,0,0,1,227,192,0,224,14,0,0,3,128,224,0,224,14,0,0,7,0,112,0,112,28,0,0,7,0,112,0,56,60,0,0,7,0,48,0,63,248,0,0,7,0,48,0,15,224,0,0,7,0,112,0,1,0,0,0,7,0,112,0,0,0,0,0,3,128,240,0,0,0,0,0,3,193,224,0,0,0,0,0,1,255,192,0,0,0,0,0,0,255,128,0,0,0,0,0,0,62,0,0},
  {3,224,0,0,0,0,0,0,15,248,0,0,3,248,0,0,31,252,0,0,7,254,0,0,60,30,0,0,15,159,0,0,120,14,0,0,30,7,0,0,112,7,0,0,28,3,128,0,112,7,0,0,56,1,128,0,96,3,0,0,56,1,128,0,112,7,0,0,56,1,128,0,112,7,0,0,56,1,128,0,112,7,0,0,24,3,128,0,56,14,0,0,28,3,128,0,30,62,0,0,30,7,0,0,15,255,0,0,15,254,0,0,7,247,128,0,7,252,0,0,0,3,192,0,7,248,0,0,0,1,224,0,7,0,0,0,0,0,240,0,15,0,0,0,0,0,120,0,14,0,0,0,0,0,60,7,238,0,0,0,0,0,30,63,252,0,0,0,0,0,15,127,254,0,0,0,0,0,7,240,15,128,0,0,0,0,3,192,3,192,0,0,0,0,3,128,1,192,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,12,0,0,48,0,0,0,0,28,0,0,56,0,0,0,0,28,0,0,56,7,224,0,0,28,0,0,56,15,248,0,0,28,0,0,56,63,252,0,0,28,0,0,56,56,28,0,0,28,0,0,63,240,14,0,0,12,0,0,63,224,6,0,0,14,0,0,115,224,7,0,0,14,0,0,112,224,7,0,0,7,0,0,224,96,7,0,0,15,128,1,192,96,6,0,0,63,192,3,192,112,14,0,0,121,240,15,128,56,30,0,0,240,127,254,0,62,124,15,227,224,63,254,0,31,248,31,255,128,7,231,0,7,224,60,63,0,0,7,0,0,0,112,30,0,0,3,128,0,0,96,14,0,0,3,128,0,0,224,14,0,0,1,192,0,0,224,6,0,0,1,255,0,0,224,6,0,0,1,255,128,0,224,6,0,0,3,195,192,0,224,14,0,0,7,1,224,0,112,30,0,0,7,0,224,0,120,60,0,0,6,0,96,0,63,248,0,0,14,0,96,0,15,240,0,0,14,0,112,0,3,192,0,0,14,0,96,0,0,0,0,0,6,0,224,0,0,0,0,0,7,0,224,0,0,0,0,0,3,129,192,0,0,0,0,0,3,255,128,0,0,0,0,0,0,255,0,0,0,0,0,0,0,60,0,0},
  {1,240,0,0,0,0,0,0,7,252,0,0,0,32,0,0,15,254,0,0,1,252,0,0,30,15,0,0,7,255,0,0,56,7,0,0,7,135,128,0,56,3,128,0,14,3,128,0,56,3,128,0,28,1,192,0,48,3,128,0,28,1,192,0,48,3,128,0,28,0,192,0,56,3,128,0,28,0,192,0,56,3,0,0,28,1,192,0,28,7,0,0,28,1,192,0,31,31,0,0,14,3,192,0,15,255,128,0,15,7,128,0,3,251,192,0,7,255,0,0,0,1,224,0,3,254,0,0,0,0,240,0,3,240,0,0,0,0,112,0,7,0,0,0,0,0,56,0,7,0,0,0,0,0,28,7,238,0,0,0,0,0,30,63,254,0,0,0,0,0,15,127,254,0,0,0,0,0,7,240,15,128,0,0,0,0,3,192,3,192,0,0,0,0,3,128,1,192,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,12,0,0,48,0,0,0,0,28,0,0,56,0,0,0,0,28,0,0,56,1,0,0,0,28,0,0,56,15,224,0,0,28,0,0,56,31,248,0,0,28,0,0,56,60,60,0,0,28,0,0,62,112,28,0,0,12,0,0,63,224,14,0,0,14,0,0,127,224,6,0,0,14,0,0,112,224,6,0,0,15,0,0,224,224,6,0,0,31,128,1,192,224,6,0,0,127,192,3,192,96,14,1,128,249,240,15,128,112,30,15,241,224,127,254,0,56,60,63,255,192,63,254,0,63,248,56,63,0,7,238,0,15,240,112,30,0,0,7,0,3,128,224,14,0,0,7,0,0,0,224,14,0,0,7,128,0,0,224,6,0,0,3,176,0,0,224,6,0,0,3,254,0,0,224,14,0,0,3,255,0,0,224,14,0,0,7,135,128,0,112,28,0,0,14,1,192,0,56,60,0,0,14,1,192,0,63,248,0,0,12,0,192,0,15,240,0,0,28,0,224,0,1,128,0,0,28,0,224,0,0,0,0,0,28,0,192,0,0,0,0,0,14,1,192,0,0,0,0,0,14,1,192,0,0,0,0,0,7,135,128,0,0,0,0,0,3,255,0,0,0,0,0,0,1,254,0,0,0,0,0,0,0,48,0,0},
  {0,248,0,0,0,0,0,0,3,254,0,0,0,0,0,0,7,255,0,0,0,24,0,0,15,7,128,0,0,255,0,0,14,3,192,0,3,255,128,0,28,1,192,0,3,195,192,0,28,1,192,0,7,1,192,0,28,0,192,0,6,0,224,0,28,0,192,0,14,0,224,0,28,1,192,0,14,0,96,0,28,1,192,0,14,0,96,0,14,3,128,0,14,0,96,0,7,143,128,0,6,0,224,0,3,255,192,0,7,1,224,0,1,253,192,0,3,131,192,0,0,0,224,0,3,255,128,0,0,0,112,0,1,255,0,0,0,0,120,0,3,184,0,0,0,0,60,0,3,128,0,0,0,0,30,7,231,0,0,0,0,0,15,63,255,0,0,0,0,0,7,255,254,0,0,0,0,0,3,240,15,128,0,0,0,0,3,192,3,192,0,0,0,0,3,128,1,192,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,12,0,0,48,0,0,0,0,28,0,0,56,0,0,0,0,28,0,0,56,0,0,0,0,28,0,0,56,7,128,0,0,28,0,0,56,31,240,0,0,28,0,0,56,63,248,0,0,28,0,0,56,120,60,0,0,12,0,0,63,240,28,0,0,14,0,0,127,224,14,0,0,14,0,0,115,192,14,0,0,31,0,0,224,192,14,0,0,63,128,1,192,192,14,15,224,251,192,3,192,224,14,31,241,225,240,15,128,224,12,62,127,192,127,254,0,112,28,120,31,0,63,252,0,120,120,112,14,0,7,252,0,63,240,224,14,0,0,14,0,15,224,224,6,0,0,14,0,0,0,224,6,0,0,7,0,0,0,224,6,0,0,7,224,0,0,224,14,0,0,7,252,0,0,112,14,0,0,15,254,0,0,120,28,0,0,30,15,0,0,63,248,0,0,28,7,0,0,31,240,0,0,56,3,128,0,7,224,0,0,56,3,128,0,0,0,0,0,56,1,128,0,0,0,0,0,56,1,128,0,0,0,0,0,56,3,128,0,0,0,0,0,56,3,128,0,0,0,0,0,28,7,0,0,0,0,0,0,14,15,0,0,0,0,0,0,15,254,0,0,0,0,0,0,3,248,0,0,0,0,0,0,0,64,0,0},
  {0,126,0,0,0,0,0,0,0,255,0,0,0,0,0,0,3,255,192,0,0,0,0,0,3,129,192,0,0,0,0,0,7,0,224,0,0,127,128,0,6,0,96,0,0,255,192,0,6,0,112,0,1,225,224,0,14,0,112,0,3,128,240,0,6,0,112,0,3,128,112,0,6,0,96,0,3,0,48,0,7,0,224,0,7,0,48,0,3,129,224,0,7,0,56,0,3,231,192,0,7,0,48,0,1,255,224,0,3,0,112,0,0,127,224,0,3,128,112,0,0,0,112,0,1,193,224,0,0,0,56,0,1,255,192,0,0,0,60,0,1,255,128,0,0,0,30,0,1,222,0,0,0,0,15,7,227,128,0,0,0,0,7,63,255,128,0,0,0,0,3,255,255,0,0,0,0,0,3,240,15,128,0,0,0,0,3,192,3,192,0,0,0,0,3,128,1,192,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,12,0,0,48,0,0,0,0,28,0,0,56,0,0,0,0,28,0,0,56,0,0,0,0,28,0,0,56,0,0,0,0,28,0,0,56,15,192,0,0,28,0,0,56,63,224,0,0,28,0,0,56,127,240,0,0,12,0,0,62,240,56,0,0,14,0,0,127,224,28,0,0,30,0,0,127,192,28,7,224,63,0,0,225,192,12,31,240,255,128,1,193,192,12,62,255,227,192,3,193,192,12,120,31,193,240,15,129,192,12,112,15,0,127,254,0,224,28,224,14,0,63,252,0,240,56,224,6,0,7,252,0,124,248,224,6,0,0,28,0,63,240,224,6,0,0,28,0,31,192,224,14,0,0,14,0,0,0,112,14,0,0,15,224,0,0,120,28,0,0,15,240,0,0,62,248,0,0,63,252,0,0,31,240,0,0,56,28,0,0,7,224,0,0,112,14,0,0,0,0,0,0,96,6,0,0,0,0,0,0,224,6,0,0,0,0,0,0,224,7,0,0,0,0,0,0,224,6,0,0,0,0,0,0,96,6,0,0,0,0,0,0,112,14,0,0,0,0,0,0,120,28,0,0,0,0,0,0,62,124,0,0,0,0,0,0,31,248,0,0,0,0,0,0,7,224,0,0,0,0,0,0,0,0,0,0},
  {0,31,0,0,0,0,0,0,0,127,192,0,0,0,0,0,0,255,224,0,0,0,0,0,1,224,112,0,0,0,0,0,1,192,56,0,0,0,0,0,3,128,56,0,0,31,192,0,3,128,24,0,0,127,224,0,3,128,24,0,0,249,240,0,3,128,24,0,0,224,120,0,3,128,56,0,1,192,56,0,1,192,56,0,1,128,28,0,1,192,112,0,1,128,28,0,0,241,240,0,1,128,28,0,0,127,240,0,1,128,28,0,0,63,248,0,1,192,24,0,0,0,56,0,1,192,56,0,0,0,28,0,0,224,120,0,0,0,30,0,0,255,240,0,0,0,15,0,0,255,224,0,0,0,7,7,225,255,128,0,0,0,3,191,253,192,0,0,0,0,3,255,255,128,0,0,0,0,1,240,15,128,0,0,0,0,3,192,3,192,0,0,0,0,3,128,1,192,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,12,0,0,48,0,0,0,0,28,0,0,56,0,0,0,0,28,0,0,56,0,0,0,0,28,0,0,56,0,0,0,0,28,0,0,56,0,0,0,0,28,0,0,56,31,128,0,0,28,0,0,56,63,224,0,0,12,0,0,56,127,240,15,224,30,0,0,126,224,120,31,248,126,0,0,127,192,56,60,125,255,0,0,231,192,24,112,31,227,128,1,193,128,28,96,15,131,192,3,193,128,28,224,14,1,240,15,129,128,28,224,6,0,127,254,1,128,28,224,6,0,63,252,1,192,56,224,6,0,7,248,0,224,120,224,14,0,0,56,0,249,240,112,14,0,0,56,0,127,224,120,60,0,0,28,0,31,192,63,248,0,0,31,128,0,0,31,240,0,0,127,224,0,0,7,192,0,0,249,240,0,0,0,0,0,0,224,120,0,0,0,0,0,1,192,56,0,0,0,0,0,1,128,24,0,0,0,0,0,3,128,28,0,0,0,0,0,3,128,28,0,0,0,0,0,1,128,24,0,0,0,0,0,1,128,24,0,0,0,0,0,1,192,56,0,0,0,0,0,0,224,112,0,0,0,0,0,0,255,240,0,0,0,0,0,0,63,192,0,0,0,0,0,0,31,128,0,0,0,0,0,0,0,0,0,0},
  {0,7,192,0,0,0,0,0,0,31,240,0,0,0,0,0,0,63,248,0,0,0,0,0,0,120,60,0,0,0,0,0,0,112,14,0,0,0,0,0,0,224,14,0,0,0,0,0,0,224,6,0,0,7,192,0,0,224,6,0,0,31,240,0,0,224,6,0,0,63,248,0,0,224,14,0,0,120,60,0,0,112,14,0,0,112,30,0,0,112,28,0,0,224,14,0,0,60,124,0,0,224,14,0,0,31,248,0,0,224,6,0,0,15,252,0,0,224,14,0,0,0,30,0,0,224,14,0,0,0,14,0,0,224,14,0,0,0,7,0,0,112,28,0,0,0,7,128,0,124,120,0,0,0,3,135,224,127,240,0,0,0,1,255,252,239,224,0,0,0,1,255,255,224,0,0,0,0,1,240,15,192,0,0,0,0,3,192,3,192,0,0,0,0,3,128,1,192,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,12,0,0,48,0,0,0,0,28,0,0,56,0,0,0,0,28,0,0,56,0,0,0,0,28,0,0,56,0,0,0,0,28,0,0,56,0,0,3,192,28,0,0,56,0,0,31,240,28,0,0,56,31,0,63,248,60,0,0,48,127,192,120,61,254,0,0,120,255,224,112,15,254,0,0,127,224,240,224,15,199,0,0,255,192,120,224,6,3,128,1,199,128,56,224,6,3,192,3,195,128,56,224,6,1,240,15,131,128,24,224,14,0,127,254,3,128,56,96,14,0,63,252,3,128,56,112,28,0,7,240,3,128,56,60,60,0,0,112,1,192,112,31,248,0,0,112,0,241,224,15,224,0,0,112,0,127,224,0,0,0,0,255,0,63,128,0,0,0,1,255,128,0,0,0,0,0,3,195,192,0,0,0,0,0,7,0,224,0,0,0,0,0,7,0,224,0,0,0,0,0,6,0,96,0,0,0,0,0,14,0,96,0,0,0,0,0,14,0,112,0,0,0,0,0,14,0,96,0,0,0,0,0,7,0,224,0,0,0,0,0,7,0,224,0,0,0,0,0,3,131,192,0,0,0,0,0,3,255,128,0,0,0,0,0,0,255,0,0,0,0,0,0,0,56,0,0,0,0,0,0,0,0,0,0,0},
  {0,1,240,0,0,0,0,0,0,7,252,0,0,0,0,0,0,15,254,0,0,0,0,0,0,30,15,0,0,0,0,0,0,28,3,128,0,0,0,0,0,56,3,128,0,0,0,0,0,56,1,128,0,0,0,0,0,56,1,128,0,0,0,0,0,56,1,128,0,7,248,0,0,56,3,128,0,15,252,0,0,28,3,128,0,30,30,0,0,28,7,0,0,56,15,0,0,15,31,0,0,56,7,0,0,7,254,0,0,48,3,0,0,3,254,0,0,112,3,128,0,0,7,0,0,112,3,128,0,0,7,0,0,48,3,0,0,0,3,128,0,56,7,0,0,0,1,192,0,56,7,0,0,0,1,199,224,28,30,0,0,0,0,255,252,63,252,0,0,0,0,255,254,119,248,0,0,0,1,240,15,225,224,0,0,0,3,192,3,192,0,0,0,0,3,128,1,192,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,12,0,0,48,0,0,0,0,28,0,0,56,0,0,1,0,28,0,0,56,0,0,15,224,28,0,0,56,0,0,63,248,28,0,0,56,0,0,60,60,28,0,0,56,0,0,112,28,252,0,0,56,0,0,96,15,252,0,0,48,28,0,224,15,254,0,0,112,127,128,224,7,14,0,0,125,255,192,224,6,7,0,0,255,193,224,224,14,3,128,1,223,128,112,224,14,3,192,3,199,0,112,112,30,1,240,15,135,0,48,56,60,0,127,254,7,0,48,63,248,0,63,252,7,0,48,15,240,0,7,224,7,0,48,3,128,0,0,192,3,128,112,0,0,0,0,192,3,128,240,0,0,0,1,240,1,225,224,0,0,0,7,252,0,255,192,0,0,0,15,254,0,127,128,0,0,0,30,15,0,8,0,0,0,0,28,7,128,0,0,0,0,0,56,3,128,0,0,0,0,0,56,3,128,0,0,0,0,0,56,1,128,0,0,0,0,0,56,1,128,0,0,0,0,0,56,3,128,0,0,0,0,0,56,3,128,0,0,0,0,0,28,7,0,0,0,0,0,0,15,15,0,0,0,0,0,0,7,254,0,0,0,0,0,0,3,248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,124,0,0,0,0,0,0,1,255,0,0,0,0,0,0,3,255,128,0,0,0,0,0,3,129,192,0,0,0,0,0,7,0,224,0,0,0,0,0,6,0,224,0,0,0,0,0,14,0,96,0,0,0,0,0,14,0,96,0,0,0,0,0,14,0,96,0,0,0,0,0,14,0,96,0,0,248,0,0,7,0,224,0,3,254,0,0,7,129,192,0,7,255,0,0,3,199,192,0,15,7,128,0,1,255,128,0,28,3,128,0,0,255,128,0,28,1,192,0,0,3,128,0,24,1,192,0,0,1,192,0,24,1,192,0,0,1,192,0,24,1,192,0,0,0,224,0,28,1,192,0,0,0,231,224,28,3,128,0,0,0,127,252,14,3,128,0,0,0,127,254,31,143,0,0,0,1,240,15,255,254,0,0,0,3,192,3,241,252,0,0,0,3,128,1,224,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,15,224,12,0,0,48,0,0,31,248,28,0,0,56,0,0,60,124,28,0,0,56,0,0,112,28,28,0,0,56,0,0,112,14,60,0,0,56,0,0,224,15,252,0,0,56,0,0,224,7,252,0,0,56,0,0,224,7,140,0,0,48,0,0,224,6,14,0,0,112,0,0,224,14,14,0,0,112,255,0,112,14,7,0,0,253,255,128,120,60,3,128,1,255,195,192,63,248,3,192,3,223,128,224,31,240,1,240,15,135,0,224,7,192,0,127,254,6,0,96,0,0,0,63,252,6,0,112,0,0,0,7,224,14,0,112,0,0,0,3,128,6,0,112,0,0,0,3,128,7,0,96,0,0,0,15,192,7,0,224,0,0,0,31,240,3,193,192,0,0,0,126,248,1,255,192,0,0,0,112,60,0,255,0,0,0,0,224,28,0,60,0,0,0,0,224,14,0,0,0,0,0,0,192,14,0,0,0,0,0,0,192,14,0,0,0,0,0,0,192,14,0,0,0,0,0,0,224,14,0,0,0,0,0,0,224,28,0,0,0,0,0,0,112,60,0,0,0,0,0,0,63,248,0,0,0,0,0,0,31,240,0,0,0,0,0,0,15,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,31,128,0,0,0,0,0,0,63,192,0,0,0,0,0,0,255,240,0,0,0,0,0,0,224,112,0,0,0,0,0,1,192,56,0,0,0,0,0,1,128,24,0,0,0,0,0,1,128,28,0,0,0,0,0,3,128,28,0,0,0,0,0,1,128,28,0,0,0,0,0,1,128,24,0,0,0,0,0,1,192,56,0,0,0,0,0,0,224,120,0,0,254,0,0,0,249,240,0,1,255,0,0,0,127,224,0,3,199,128,0,0,31,192,0,7,1,192,0,0,0,224,0,14,0,224,0,0,0,224,0,14,0,224,0,0,0,112,0,14,0,224,0,0,0,112,0,12,0,96,0,0,0,119,224,14,0,224,0,0,0,63,252,14,0,224,0,0,0,127,254,15,1,192,0,0,1,240,15,159,131,192,0,0,3,192,3,255,255,128,0,0,3,128,1,249,255,0,15,224,7,0,0,240,124,0,31,240,14,0,0,112,0,0,62,120,14,0,0,112,0,0,120,28,12,0,0,48,0,0,112,14,28,0,0,56,0,0,224,14,28,0,0,56,0,0,224,7,252,0,0,56,0,0,224,7,252,0,0,56,0,0,224,7,252,0,0,56,0,0,224,14,28,0,0,56,0,0,112,14,12,0,0,48,0,0,120,28,14,0,0,112,0,0,63,248,14,0,0,112,0,0,31,240,7,0,0,240,254,0,7,224,3,128,1,249,255,0,0,0,3,192,3,255,207,128,0,0,1,240,15,159,3,192,0,0,0,127,254,14,1,192,0,0,0,63,252,14,0,224,0,0,0,7,224,12,0,224,0,0,0,6,0,12,0,224,0,0,0,14,0,12,0,224,0,0,0,127,0,14,0,224,0,0,0,255,192,14,1,192,0,0,1,225,224,7,3,192,0,0,3,128,224,3,255,128,0,0,3,0,112,1,255,0,0,0,7,0,48,0,252,0,0,0,7,0,48,0,0,0,0,0,7,0,48,0,0,0,0,0,7,0,48,0,0,0,0,0,3,0,112,0,0,0,0,0,3,128,112,0,0,0,0,0,1,193,224,0,0,0,0,0,1,255,192,0,0,0,0,0,0,127,128,0,0,0,0,0,0,28,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,3,224,0,0,0,0,0,0,15,248,0,0,0,0,0,0,31,252,0,0,0,0,0,0,60,30,0,0,0,0,0,0,112,14,0,0,0,0,0,0,112,7,0,0,0,0,0,0,96,7,0,0,0,0,0,0,96,7,0,0,0,0,0,0,96,7,0,0,0,0,0,0,112,7,0,0,0,0,0,0,112,14,0,0,0,0,0,0,56,14,0,0,0,0,0,0,62,60,0,0,28,0,0,0,31,248,0,0,255,128,0,0,7,240,0,1,255,192,0,0,0,112,0,3,193,224,0,0,0,48,0,3,128,224,0,0,0,56,0,7,0,112,0,0,0,56,0,7,0,112,0,0,0,31,224,6,0,48,0,0,0,63,252,7,0,112,0,0,0,127,254,7,0,112,15,224,1,240,15,135,0,112,31,240,3,192,3,207,128,224,62,248,3,128,1,255,193,192,120,28,7,0,0,253,255,192,112,14,14,0,0,112,127,0,224,14,14,0,0,112,8,0,224,6,12,0,0,48,0,0,224,7,252,0,0,56,0,0,224,7,252,0,0,56,0,0,224,15,252,0,0,56,0,0,112,14,28,0,0,56,0,0,120,28,28,0,0,56,0,0,63,248,28,0,0,56,0,0,31,240,12,0,0,48,0,0,7,224,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,7,0,0,224,0,0,0,0,3,128,1,240,248,0,0,0,3,192,3,251,254,0,0,0,1,240,15,191,255,0,0,0,0,127,254,31,7,128,0,0,0,63,252,14,3,192,0,0,0,31,224,28,1,192,0,0,0,28,0,28,1,192,0,0,0,252,0,28,0,192,0,0,3,252,0,28,1,192,0,0,7,255,0,28,1,192,0,0,15,7,0,28,1,192,0,0,28,3,128,14,3,128,0,0,28,1,128,7,143,0,0,0,24,1,192,3,255,0,0,0,24,1,192,1,252,0,0,0,24,1,192,0,0,0,0,0,24,1,192,0,0,0,0,0,28,3,128,0,0,0,0,0,14,3,128,0,0,0,0,0,15,15,0,0,0,0,0,0,7,254,0,0,0,0,0,0,1,252,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,248,0,0,0,0,0,0,3,254,0,0,0,0,0,0,7,255,0,0,0,0,0,0,15,7,128,0,0,0,0,0,14,3,192,0,0,0,0,0,28,1,192,0,0,0,0,0,28,1,192,0,0,0,0,0,28,0,192,0,0,0,0,0,28,0,192,0,0,0,0,0,28,1,192,0,0,0,0,0,28,1,192,0,0,0,0,0,14,3,128,0,0,0,0,0,7,143,0,0,0,0,0,0,3,254,0,0,0,0,0,0,1,252,0,0,63,0,0,0,0,28,0,0,127,192,0,0,0,28,0,0,255,224,0,0,0,28,0,1,192,240,0,0,0,12,0,3,128,112,7,224,0,15,224,3,128,56,31,240,0,63,252,3,0,56,62,248,0,127,254,3,0,56,120,28,1,240,15,131,0,56,112,14,3,192,3,195,128,56,224,14,3,128,1,207,128,112,224,6,7,0,0,255,192,240,224,6,14,0,0,127,243,224,224,7,206,0,0,120,255,192,224,15,252,0,0,48,63,128,112,15,252,0,0,56,0,0,120,28,28,0,0,56,0,0,62,248,28,0,0,56,0,0,31,240,28,0,0,56,0,0,7,224,28,0,0,56,0,0,0,0,28,0,0,56,0,0,0,0,12,0,0,48,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,7,0,0,224,0,0,0,0,3,128,1,224,0,0,0,0,3,192,3,224,96,0,0,0,1,240,15,251,252,0,0,0,0,127,254,63,254,0,0,0,0,63,252,31,15,0,0,0,0,63,224,28,7,128,0,0,0,112,0,24,3,128,0,0,15,240,0,56,1,128,0,0,31,240,0,56,1,128,0,0,62,124,0,56,1,128,0,0,120,28,0,56,1,128,0,0,112,14,0,24,3,128,0,0,224,14,0,28,7,128,0,0,224,6,0,14,15,0,0,0,224,6,0,15,254,0,0,0,224,6,0,3,252,0,0,0,224,14,0,0,96,0,0,0,112,14,0,0,0,0,0,0,120,28,0,0,0,0,0,0,63,248,0,0,0,0,0,0,31,240,0,0,0,0,0,0,7,224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,62,0,0,0,0,0,0,0,255,128,0,0,0,0,0,1,255,192,0,0,0,0,0,1,192,224,0,0,0,0,0,3,128,112,0,0,0,0,0,3,0,112,0,0,0,0,0,7,0,48,0,0,0,0,0,7,0,48,0,0,0,0,0,7,0,48,0,0,0,0,0,7,0,48,0,0,0,0,0,3,128,112,0,0,0,0,0,3,192,224,0,0,0,0,0,1,227,224,0,0,0,0,0,0,255,192,0,0,0,0,0,0,127,0,0,0,0,0,0,0,14,0,0,0,0,7,224,0,6,0,0,31,128,31,240,0,6,0,0,127,192,63,248,0,7,0,0,255,240,120,28,0,7,224,0,224,112,112,14,0,63,252,1,192,56,224,14,0,127,254,1,128,56,224,6,1,240,15,131,128,24,224,6,3,192,3,195,128,28,224,6,3,128,1,195,128,24,224,15,135,0,0,231,128,24,112,15,254,0,0,127,192,56,120,29,254,0,0,127,224,112,62,120,60,0,0,56,249,240,31,240,28,0,0,56,127,224,15,224,28,0,0,56,31,128,0,0,28,0,0,56,0,0,0,0,28,0,0,56,0,0,0,0,28,0,0,56,0,0,0,0,28,0,0,56,0,0,0,0,12,0,0,48,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,7,0,0,224,0,0,0,0,3,128,1,192,0,0,0,0,3,192,3,192,0,0,0,0,1,240,15,224,0,0,0,0,0,127,254,243,240,0,0,0,0,127,252,127,252,0,0,0,0,231,224,63,62,0,0,0,4,224,0,60,15,0,0,0,127,192,0,56,7,0,0,0,255,192,0,48,3,0,0,1,225,224,0,112,3,128,0,1,192,112,0,112,3,128,0,3,128,48,0,48,3,0,0,3,0,56,0,48,3,0,0,3,0,56,0,56,7,0,0,3,0,56,0,28,14,0,0,3,0,56,0,31,254,0,0,3,128,48,0,7,248,0,0,3,192,112,0,3,240,0,0,1,224,224,0,0,0,0,0,0,255,224,0,0,0,0,0,0,127,128,0,0,0,0,0,0,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,15,192,0,0,0,0,0,0,31,224,0,0,0,0,0,0,127,248,0,0,0,0,0,0,112,56,0,0,0,0,0,0,224,28,0,0,0,0,0,0,192,12,0,0,0,0,0,1,192,12,0,0,0,0,0,1,192,14,0,0,0,0,0,1,192,12,0,0,0,0,0,0,192,12,0,0,0,0,0,0,224,28,0,0,0,0,0,0,240,60,0,0,0,0,0,0,124,248,0,0,0,7,192,0,63,240,0,0,0,31,240,0,15,192,0,0,0,63,248,0,3,128,0,0,0,120,60,0,3,128,0,0,0,112,14,0,3,128,0,0,0,224,14,0,3,128,0,15,128,224,6,0,7,224,0,63,224,224,6,0,63,252,0,127,240,224,6,0,127,254,0,240,120,224,14,1,240,15,128,224,56,96,15,131,192,3,193,192,28,112,31,227,128,1,193,192,28,60,125,255,0,0,225,128,28,31,248,126,0,0,113,128,28,15,224,30,0,0,127,192,28,0,0,12,0,0,63,192,28,0,0,28,0,0,62,224,56,0,0,28,0,0,56,120,240,0,0,28,0,0,56,127,224,0,0,28,0,0,56,31,192,0,0,28,0,0,56,0,0,0,0,28,0,0,56,0,0,0,0,12,0,0,48,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,7,0,0,224,0,0,0,0,3,128,1,192,0,0,0,0,3,192,3,192,0,0,0,0,1,240,15,192,0,0,0,0,0,255,255,224,0,0,0,0,1,255,252,247,224,0,0,0,3,199,224,127,248,0,0,0,127,128,0,63,252,0,0,1,255,0,0,56,30,0,0,7,255,0,0,112,14,0,0,7,3,128,0,112,7,0,0,14,1,192,0,96,7,0,0,12,1,192,0,96,7,0,0,28,0,192,0,96,7,0,0,28,0,192,0,112,7,0,0,28,0,192,0,112,14,0,0,28,0,192,0,56,30,0,0,14,1,192,0,63,124,0,0,14,3,128,0,15,248,0,0,7,143,128,0,7,224,0,0,3,255,0,0,0,0,0,0,1,252,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,3,240,0,0,0,0,0,0,7,248,0,0,0,0,0,0,31,254,0,0,0,0,0,0,28,14,0,0,0,0,0,0,56,7,0,0,0,0,0,0,48,3,0,0,0,0,0,0,48,3,0,0,0,0,0,0,112,3,128,0,0,0,0,0,112,3,128,0,0,0,0,0,48,3,0,0,0,1,0,0,56,7,0,0,0,15,224,0,60,15,0,0,0,63,248,0,31,62,0,0,0,60,60,0,15,252,0,0,0,112,28,0,3,240,0,0,0,224,14,0,1,192,0,0,0,224,14,0,1,192,0,0,0,224,6,0,1,192,0,0,0,224,6,0,1,192,0,0,0,224,14,0,7,224,0,0,0,224,14,0,63,252,0,7,128,112,31,0,127,254,0,31,224,56,63,193,240,15,128,127,240,63,251,243,192,3,192,112,120,15,240,255,128,1,192,224,28,3,128,63,0,0,224,192,28,0,0,14,0,0,113,192,12,0,0,14,0,0,113,192,14,0,0,12,0,0,63,192,12,0,0,28,0,0,63,192,12,0,0,28,0,0,63,224,28,0,0,28,0,0,56,224,60,0,0,28,0,0,56,120,120,0,0,28,0,0,56,63,240,0,0,28,0,0,56,31,192,0,0,12,0,0,48,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,7,0,0,224,0,0,0,0,3,128,1,192,0,0,0,0,3,192,3,192,0,0,0,0,1,240,15,128,0,0,0,0,3,255,255,192,0,0,0,0,3,191,253,224,0,0,0,0,7,7,224,247,192,0,0,7,254,0,0,127,240,0,0,15,254,0,0,63,248,0,0,31,124,0,0,120,60,0,0,56,14,0,0,112,30,0,0,120,7,0,0,224,14,0,0,112,7,0,0,224,14,0,0,112,7,0,0,224,6,0,0,96,3,0,0,224,14,0,0,112,7,0,0,224,14,0,0,112,7,0,0,224,14,0,0,56,7,0,0,112,28,0,0,60,30,0,0,60,120,0,0,31,124,0,0,31,248,0,0,15,248,0,0,15,224,0,0,3,240,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,248,0,0,0,0,0,0,1,254,0,0,0,0,0,0,7,255,128,0,0,0,0,0,7,3,128,0,0,0,0,0,14,1,192,0,0,0,0,0,12,1,192,0,0,0,0,0,28,0,192,0,0,0,0,0,28,0,224,0,0,7,192,0,28,0,192,0,0,31,240,0,12,0,192,0,0,63,248,0,14,1,192,0,0,120,28,0,15,3,128,0,0,112,14,0,7,207,128,0,0,224,14,0,3,255,0,0,0,224,6,0,1,252,0,0,0,224,6,0,0,96,0,0,0,224,6,0,0,224,0,0,0,224,14,0,0,224,0,0,0,112,14,0,0,224,0,0,0,112,31,0,7,224,0,0,0,62,127,128,63,252,0,0,0,31,251,224,127,254,0,0,0,15,225,241,240,15,128,7,128,0,0,127,192,3,192,31,224,0,0,63,128,1,192,63,248,0,0,15,0,0,224,120,56,0,0,14,0,0,112,224,28,0,0,14,0,0,112,224,14,0,0,12,0,0,48,192,14,0,0,28,0,0,63,192,14,0,0,28,0,0,63,192,14,0,0,28,0,0,63,224,14,0,0,28,0,0,56,224,28,0,0,28,0,0,56,112,28,0,0,28,0,0,56,120,120,0,0,12,0,0,48,63,240,0,0,14,0,0,112,15,224,0,0,14,0,0,112,0,0,0,0,7,0,0,224,0,0,0,0,3,128,1,192,0,0,0,0,3,192,3,192,0,0,0,0,3,240,15,128,0,0,0,0,7,255,255,128,0,0,0,0,15,63,253,192,0,0,0,2,30,7,225,224,0,0,0,31,252,0,0,231,128,0,0,127,248,0,0,127,224,0,0,240,120,0,0,127,240,0,0,224,56,0,0,112,120,0,1,192,28,0,0,224,28,0,1,192,28,0,0,192,28,0,1,128,28,0,1,192,12,0,1,128,28,0,1,192,14,0,1,192,28,0,1,192,12,0,1,192,28,0,0,192,12,0,0,224,56,0,0,224,28,0,0,240,120,0,0,224,60,0,0,127,240,0,0,120,120,0,0,63,224,0,0,63,240,0,0,7,0,0,0,31,224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,62,0,0,0,0,0,0,0,255,128,0,0,0,0,0,1,255,192,0,0,0,0,0,3,193,224,0,0,0,0,0,3,128,240,0,0,0,0,0,7,0,112,0,0,15,224,0,7,0,112,0,0,31,240,0,7,0,48,0,0,62,120,0,7,0,48,0,0,120,28,0,7,0,112,0,0,112,14,0,7,0,112,0,0,224,14,0,3,128,224,0,0,224,6,0,1,227,192,0,0,224,6,0,0,255,128,0,0,224,6,0,0,127,0,0,0,224,14,0,0,56,0,0,0,112,14,0,0,112,0,0,0,120,30,0,0,112,0,0,0,63,255,128,0,112,0,0,0,31,247,192,7,240,0,0,0,7,225,224,63,252,0,0,0,0,0,240,127,254,0,0,0,0,0,125,240,15,128,0,0,0,0,31,192,3,192,0,0,0,0,15,128,1,192,7,192,0,0,7,0,0,224,31,240,0,0,14,0,0,112,63,248,0,0,14,0,0,112,120,60,0,0,12,0,0,48,112,30,0,0,28,0,0,56,224,14,0,0,28,0,0,56,224,14,0,0,28,0,0,63,224,6,0,0,28,0,0,63,224,14,0,0,28,0,0,56,224,14,0,0,28,0,0,56,224,14,0,0,12,0,0,48,112,28,0,0,14,0,0,112,60,120,0,0,14,0,0,112,31,240,0,0,7,0,0,224,15,224,0,0,3,128,1,192,0,0,0,0,3,192,3,192,0,0,0,0,7,240,15,128,0,0,0,0,15,127,255,128,0,0,0,0,30,63,255,128,0,0,0,28,60,7,225,192,0,0,0,255,248,0,1,224,0,0,1,255,240,0,0,239,0,0,3,193,224,0,0,127,224,0,3,128,224,0,0,127,240,0,7,0,112,0,0,240,120,0,7,0,112,0,1,224,56,0,7,0,48,0,1,192,28,0,7,0,48,0,1,128,28,0,7,0,112,0,1,128,28,0,7,0,112,0,1,128,28,0,3,128,224,0,1,192,28,0,1,193,224,0,1,192,24,0,1,255,192,0,0,224,56,0,0,127,0,0,0,240,240,0,0,8,0,0,0,127,224,0,0,0,0,0,0,31,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,31,128,0,0,0,0,0,0,63,192,0,0,0,0,0,0,255,240,0,0,0,0,0,0,224,112,0,0,7,224,0,1,192,56,0,0,31,240,0,1,128,24,0,0,62,248,0,1,128,28,0,0,120,28,0,3,128,28,0,0,112,14,0,1,128,28,0,0,224,14,0,1,128,24,0,0,224,6,0,1,192,56,0,0,224,6,0,0,224,120,0,0,224,6,0,0,249,240,0,0,224,14,0,0,127,224,0,0,112,14,0,0,31,128,0,0,120,30,0,0,28,0,0,0,62,255,0,0,56,0,0,0,31,255,128,0,56,0,0,0,7,227,192,0,56,0,0,0,0,1,224,7,248,0,0,0,0,0,240,63,252,0,0,0,0,0,124,127,254,0,0,0,0,0,31,240,15,128,0,0,0,0,15,192,3,192,0,0,0,0,7,128,1,192,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,15,224,0,0,14,0,0,112,31,248,0,0,12,0,0,48,60,124,0,0,28,0,0,56,120,28,0,0,28,0,0,56,112,14,0,0,28,0,0,56,224,6,0,0,28,0,0,63,224,6,0,0,28,0,0,63,224,6,0,0,28,0,0,56,224,6,0,0,12,0,0,48,96,14,0,0,14,0,0,112,112,14,0,0,14,0,0,112,56,28,0,0,7,0,0,224,63,248,0,0,3,128,1,192,31,240,0,0,7,192,3,192,7,192,0,0,15,240,15,128,0,0,0,0,30,127,255,0,0,0,0,0,60,63,255,128,0,0,0,252,112,7,227,128,0,0,1,255,224,0,1,192,0,0,7,255,192,0,1,192,0,0,7,3,128,0,0,255,128,0,14,1,192,0,0,127,192,0,12,0,192,0,0,255,224,0,28,0,192,0,1,224,112,0,28,0,224,0,1,192,56,0,28,0,192,0,1,128,56,0,12,0,192,0,3,128,24,0,14,1,192,0,3,128,24,0,15,3,128,0,3,128,24,0,7,207,128,0,3,128,24,0,3,255,0,0,1,192,56,0,0,252,0,0,1,224,112,0,0,0,0,0,0,249,240,0,0,0,0,0,0,127,224,0,0,0,0,0,0,63,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,7,192,0,0,0,0,0,0,31,240,0,0,3,128,0,0,63,248,0,0,15,240,0,0,120,60,0,0,63,248,0,0,224,28,0,0,56,60,0,0,224,14,0,0,112,30,0,0,192,14,0,0,224,14,0,0,192,14,0,0,224,14,0,0,192,14,0,0,224,6,0,0,224,14,0,0,224,6,0,0,224,28,0,0,224,14,0,0,112,28,0,0,96,14,0,0,124,120,0,0,112,28,0,0,63,240,0,0,60,62,0,0,15,224,0,0,63,255,0,0,28,0,0,0,15,231,128,0,28,0,0,0,1,3,192,0,28,0,0,0,0,1,224,0,28,0,0,0,0,0,240,7,248,0,0,0,0,0,120,63,252,0,0,0,0,0,60,127,254,0,0,0,0,0,31,240,15,128,0,0,0,0,7,192,3,192,0,0,0,0,7,128,1,192,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,3,192,0,0,12,0,0,48,15,240,0,0,28,0,0,56,63,252,0,0,28,0,0,56,56,28,0,0,28,0,0,56,112,14,0,0,28,0,0,62,112,6,0,0,28,0,0,63,224,6,0,0,28,0,0,63,224,7,0,0,12,0,0,48,224,7,0,0,14,0,0,112,96,6,0,0,14,0,0,112,112,14,0,0,7,0,0,224,120,30,0,0,7,128,1,192,60,60,0,0,15,192,3,192,31,248,0,0,31,240,15,128,15,240,0,0,60,127,255,0,0,0,0,0,120,63,255,0,0,0,3,248,240,7,227,128,0,0,7,255,192,0,3,128,0,0,15,191,128,0,1,192,0,0,28,7,0,0,1,192,0,0,60,3,128,0,0,255,128,0,56,3,128,0,0,255,192,0,56,3,128,0,0,241,224,0,48,1,128,0,1,192,112,0,56,3,128,0,3,128,120,0,56,3,128,0,3,128,56,0,28,3,128,0,3,0,56,0,30,7,0,0,3,0,56,0,15,190,0,0,3,128,56,0,7,252,0,0,3,128,56,0,1,248,0,0,3,128,112,0,0,0,0,0,1,224,240,0,0,0,0,0,0,255,224,0,0,0,0,0,0,127,192,0,0,0,0,0,0,31,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,3,224,0,0,7,192,0,0,15,248,0,0,31,240,0,0,31,252,0,0,63,248,0,0,56,28,0,0,120,60,0,0,112,14,0,0,112,14,0,0,112,6,0,0,224,14,0,0,96,7,0,0,224,6,0,0,96,7,0,0,224,6,0,0,96,7,0,0,224,6,0,0,96,7,0,0,224,14,0,0,112,14,0,0,112,14,0,0,56,30,0,0,112,28,0,0,62,60,0,0,60,126,0,0,31,248,0,0,31,255,0,0,15,240,0,0,15,231,128,0,14,0,0,0,0,3,192,0,14,0,0,0,0,1,224,0,28,0,0,0,0,0,240,0,28,0,0,0,0,0,120,7,252,0,0,0,0,0,60,63,252,0,0,0,0,0,30,127,254,0,0,0,0,0,15,240,15,128,0,0,0,0,7,192,3,192,0,0,0,0,3,128,1,192,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,12,0,0,48,1,128,0,0,28,0,0,56,15,240,0,0,28,0,0,56,31,252,0,0,28,0,0,56,60,60,0,0,28,0,0,56,112,14,0,0,28,0,0,63,240,6,0,0,28,0,0,63,224,7,0,0,12,0,0,63,224,7,0,0,14,0,0,112,96,7,0,0,14,0,0,112,96,7,0,0,7,0,0,224,112,6,0,0,7,128,1,192,120,14,0,0,15,192,3,192,60,60,0,0,63,240,15,128,31,252,0,0,120,127,255,0,15,240,0,0,240,63,255,0,1,128,7,241,224,7,231,0,0,0,15,255,192,0,3,128,0,0,30,63,0,0,3,128,0,0,56,14,0,0,1,192,0,0,112,7,0,0,0,254,0,0,112,7,0,0,0,255,128,0,112,7,0,0,0,255,224,0,96,3,0,0,1,224,224,0,112,7,0,0,3,128,112,0,112,7,0,0,3,128,48,0,56,15,0,0,3,0,48,0,60,30,0,0,7,0,56,0,31,252,0,0,7,0,56,0,15,248,0,0,3,0,48,0,3,224,0,0,3,128,112,0,0,0,0,0,3,128,112,0,0,0,0,0,1,225,224,0,0,0,0,0,0,255,192,0,0,0,0,0,0,127,128,0,0,0,0,0,0,0,0,0},
  {3,128,0,0,3,224,0,0,15,240,0,0,15,248,0,0,63,248,0,0,31,252,0,0,56,60,0,0,60,14,0,0,112,28,0,0,56,7,0,0,224,14,0,0,112,7,0,0,224,14,0,0,112,3,0,0,224,6,0,0,112,3,0,0,224,6,0,0,112,3,0,0,224,14,0,0,112,7,0,0,224,14,0,0,56,7,0,0,112,28,0,0,56,14,0,0,56,60,0,0,30,62,0,0,63,254,0,0,15,252,0,0,15,239,0,0,7,240,0,0,1,7,128,0,14,0,0,0,0,3,192,0,14,0,0,0,0,1,224,0,14,0,0,0,0,0,240,0,28,0,0,0,0,0,120,7,252,0,0,0,0,0,60,63,252,0,0,0,0,0,30,127,254,0,0,0,0,0,15,240,15,128,0,0,0,0,7,192,3,192,0,0,0,0,3,128,1,192,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,12,0,0,48,0,0,0,0,28,0,0,56,3,192,0,0,28,0,0,56,15,240,0,0,28,0,0,56,31,252,0,0,28,0,0,56,60,30,0,0,28,0,0,60,112,14,0,0,28,0,0,63,240,7,0,0,12,0,0,63,224,7,0,0,14,0,0,112,224,7,0,0,14,0,0,112,96,7,0,0,7,0,0,224,112,7,0,0,15,128,1,192,112,14,0,0,31,192,3,192,56,14,0,0,61,240,15,128,60,60,0,0,120,127,254,0,31,248,0,1,240,63,255,0,7,240,15,227,192,7,231,0,0,0,31,255,128,0,3,128,0,0,60,63,0,0,3,128,0,0,112,30,0,0,1,192,0,0,112,14,0,0,1,192,0,0,96,6,0,0,0,255,0,0,224,6,0,0,0,255,192,0,224,7,0,0,1,225,224,0,224,6,0,0,3,128,224,0,96,14,0,0,3,128,112,0,112,14,0,0,3,0,48,0,56,28,0,0,7,0,48,0,63,248,0,0,7,0,56,0,15,240,0,0,7,0,48,0,3,192,0,0,3,0,112,0,0,0,0,0,3,128,112,0,0,0,0,0,1,193,224,0,0,0,0,0,1,255,192,0,0,0,0,0,0,127,128,0,0,0,0,0,0,30,0,0},
  {7,192,0,0,3,240,0,0,31,240,0,0,7,248,0,0,63,248,0,0,31,254,0,0,120,60,0,0,28,14,0,0,112,14,0,0,56,7,0,0,224,14,0,0,48,3,0,0,224,6,0,0,112,3,0,0,224,6,0,0,112,3,128,0,224,6,0,0,112,3,128,0,224,14,0,0,48,3,0,0,112,14,0,0,56,7,0,0,112,28,0,0,60,15,0,0,60,126,0,0,31,62,0,0,31,255,0,0,15,252,0,0,15,231,128,0,7,240,0,0,0,3,192,0,7,0,0,0,0,1,224,0,14,0,0,0,0,0,240,0,14,0,0,0,0,0,120,0,30,0,0,0,0,0,60,7,252,0,0,0,0,0,30,63,252,0,0,0,0,0,15,127,254,0,0,0,0,0,7,240,15,128,0,0,0,0,3,192,3,192,0,0,0,0,3,128,1,192,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,12,0,0,48,0,0,0,0,28,0,0,56,0,128,0,0,28,0,0,56,7,240,0,0,28,0,0,56,31,252,0,0,28,0,0,56,60,60,0,0,28,0,0,56,56,14,0,0,28,0,0,63,240,6,0,0,12,0,0,63,240,7,0,0,14,0,0,113,224,7,0,0,14,0,0,112,96,7,0,0,7,0,0,224,112,7,0,0,15,128,1,192,112,7,0,0,31,192,3,192,120,14,0,0,61,240,15,128,60,28,0,0,120,127,254,0,31,252,0,1,240,63,255,0,15,240,15,227,192,7,231,0,1,192,31,255,128,0,3,128,0,0,60,63,0,0,3,128,0,0,112,30,0,0,1,192,0,0,96,14,0,0,1,192,0,0,224,14,0,0,0,255,0,0,224,6,0,0,0,255,192,0,224,6,0,0,1,227,224,0,224,6,0,0,3,192,224,0,224,14,0,0,3,128,112,0,112,30,0,0,7,0,48,0,120,60,0,0,7,0,48,0,63,248,0,0,7,0,48,0,31,240,0,0,7,0,48,0,3,192,0,0,3,0,112,0,0,0,0,0,3,128,112,0,0,0,0,0,3,192,224,0,0,0,0,0,1,255,192,0,0,0,0,0,0,255,128,0,0,0,0,0,0,62,0,0},
  {7,192,0,0,3,240,0,0,31,240,0,0,7,248,0,0,63,248,0,0,31,254,0,0,120,60,0,0,28,14,0,0,112,14,0,0,56,7,0,0,224,14,0,0,48,3,0,0,224,6,0,0,112,3,0,0,224,6,0,0,112,3,128,0,224,6,0,0,112,3,128,0,224,14,0,0,48,3,0,0,112,14,0,0,56,7,0,0,112,28,0,0,60,15,0,0,60,126,0,0,31,62,0,0,31,255,0,0,15,252,0,0,15,231,128,0,7,240,0,0,0,3,192,0,7,0,0,0,0,1,224,0,14,0,0,0,0,0,240,0,14,0,0,0,0,0,120,0,30,0,0,0,0,0,60,7,252,0,0,0,0,0,30,63,252,0,0,0,0,0,15,127,254,0,0,0,0,0,7,240,15,128,0,0,0,0,3,192,3,192,0,0,0,0,3,128,1,192,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,12,0,0,48,0,0,0,0,28,0,0,56,0,128,0,0,28,0,0,56,7,240,0,0,28,0,0,56,31,252,0,0,28,0,0,56,60,60,0,0,28,0,0,56,56,14,0,0,28,0,0,63,240,6,0,0,12,0,0,63,240,7,0,0,14,0,0,113,224,7,0,0,14,0,0,112,96,7,0,0,7,0,0,224,112,7,0,0,15,128,1,192,112,7,0,0,31,192,3,192,120,14,0,0,61,240,15,128,60,28,0,0,120,127,254,0,31,252,0,1,240,63,255,0,15,240,15,227,192,7,231,0,1,192,31,255,128,0,3,128,0,0,60,63,0,0,3,128,0,0,112,30,0,0,1,192,0,0,96,14,0,0,1,192,0,0,224,14,0,0,0,255,0,0,224,6,0,0,0,255,192,0,224,6,0,0,1,227,224,0,224,6,0,0,3,192,224,0,224,14,0,0,3,128,112,0,112,30,0,0,7,0,48,0,120,60,0,0,7,0,48,0,63,248,0,0,7,0,48,0,31,240,0,0,7,0,48,0,3,192,0,0,3,0,112,0,0,0,0,0,3,128,112,0,0,0,0,0,3,192,224,0,0,0,0,0,1,255,192,0,0,0,0,0,0,255,128,0,0,0,0,0,0,62,0,0},
  {7,192,0,0,3,240,0,0,31,240,0,0,7,248,0,0,63,248,0,0,31,254,0,0,120,60,0,0,28,14,0,0,112,14,0,0,56,7,0,0,224,14,0,0,48,3,0,0,224,6,0,0,112,3,0,0,224,6,0,0,112,3,128,0,224,6,0,0,112,3,128,0,224,14,0,0,48,3,0,0,112,14,0,0,56,7,0,0,112,28,0,0,60,15,0,0,60,126,0,0,31,62,0,0,31,255,0,0,15,252,0,0,15,231,128,0,7,240,0,0,0,3,192,0,7,0,0,0,0,1,224,0,14,0,0,0,0,0,240,0,14,0,0,0,0,0,120,0,30,0,0,0,0,0,60,7,252,0,0,0,0,0,30,63,252,0,0,0,0,0,15,127,254,0,0,0,0,0,7,240,15,128,0,0,0,0,3,192,3,192,0,0,0,0,3,128,1,192,0,0,0,0,7,0,0,224,0,0,0,0,14,0,0,112,0,0,0,0,14,0,0,112,0,0,0,0,12,0,0,48,0,0,0,0,28,0,0,56,0,128,0,0,28,0,0,56,7,240,0,0,28,0,0,56,31,252,0,0,28,0,0,56,60,60,0,0,28,0,0,56,56,14,0,0,28,0,0,63,240,6,0,0,12,0,0,63,240,7,0,0,14,0,0,113,224,7,0,0,14,0,0,112,96,7,0,0,7,0,0,224,112,7,0,0,15,128,1,192,112,7,0,0,31,192,3,192,120,14,0,0,61,240,15,128,60,28,0,0,120,127,254,0,31,252,0,1,240,63,255,0,15,240,15,227,192,7,231,0,1,192,31,255,128,0,3,128,0,0,60,63,0,0,3,128,0,0,112,30,0,0,1,192,0,0,96,14,0,0,1,192,0,0,224,14,0,0,0,255,0,0,224,6,0,0,0,255,192,0,224,6,0,0,1,227,224,0,224,6,0,0,3,192,224,0,224,14,0,0,3,128,112,0,112,30,0,0,7,0,48,0,120,60,0,0,7,0,48,0,63,248,0,0,7,0,48,0,31,240,0,0,7,0,48,0,3,192,0,0,3,0,112,0,0,0,0,0,3,128,112,0,0,0,0,0,3,192,224,0,0,0,0,0,1,255,192,0,0,0,0,0,0,255,128,0,0,0,0,0,0,62,0,0}
};

void initWiFi() {
  WiFiManager wifiManager;
  wifiManager.autoConnect("Gemini32");
  display.clearDisplay();
  display.setCursor(0, 0);
  display.print("Please connect to WiFi by navigating to: ");
  display.setCursor(0, 10);
  display.println(WiFi.localIP());
  display.display();
}

void displayAnimationFrame() {
  display.clearDisplay();
  display.drawBitmap(32, 0, frames[frame], FRAME_WIDTH, FRAME_HEIGHT, 1);
  display.display();
  frame = (frame + 1) % (sizeof(frames) / sizeof(frames[0]));
}

void displayAIResponse() {
  display.clearDisplay();
  
  int textHeight = ((aiResponse.length() / 21) + 1) * 8; // Estimate height based on length and line wrap
  int maxScrollOffset = max(0, textHeight - SCREEN_HEIGHT);

  // Constrain scrollOffset within limits
  scrollOffset = constrain(scrollOffset, 0, maxScrollOffset);

  // Set cursor for scrolling text
  display.setCursor(0, -scrollOffset);  // Adjust starting position

  display.setTextWrap(true);
  display.print("AI: ");
  display.println(aiResponse);

  display.display();
}

void sendToGeminiAPI(String userInput) {
  HTTPClient https;

  display.clearDisplay();
  display.setTextSize(2);
  display.setCursor(0, 20);
  display.print("Cooking...");
  display.display();
  display.setTextSize(1);

  if (https.begin("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=" + (String)API_KEY)) {
    https.addHeader("Content-Type", "application/json");
    
    String payload = "{\"contents\": [{\"parts\":[{\"text\":\"" + userInput + "\"}]}],\"generationConfig\": {\"maxOutputTokens\": " + (String)MAX_TOKENS + "}}";
    int httpCode = https.POST(payload);
    if (httpCode == HTTP_CODE_OK) {
      String response = https.getString();
      DynamicJsonDocument doc(2048);
      deserializeJson(doc, response);
    
      aiResponse = doc["candidates"][0]["content"]["parts"][0]["text"].as<String>();
      scrollOffset = 0;  // Reset scroll offset for new response
    
      displayAIResponse();
      responseDisplayed = true;
      Serial.println("Gemini AI Response: " + aiResponse);
    } else {
      Serial.printf("[HTTPS] GET... failed, error: %s\n", https.errorToString(httpCode).c_str());
    }
    https.end();
  } else {
    Serial.printf("[HTTPS] Unable to connect\n");
  }
}

// Draw keyboard on the OLED
void drawKeyboard() {
  int xOffset = 0;
  int yOffset = 20;

  for (int row = 0; row < 4; row++) {
    for (int col = 0; col < 10; col++) {
      display.setCursor(xOffset + col * 12, yOffset + row * 12); 
      display.print(keyboard[row][col]);
    }
  }
  display.display(); // Ensure display refresh after drawing the keyboard
}

// Draw the cursor at the specified position
void drawCursor(int x, int y) {
  int cursorXPos = x * 12;
  int cursorYPos = 20 + y * 12;
  display.drawRect(cursorXPos, cursorYPos, 12, 12, SH110X_WHITE);
}

// Clear the cursor from its previous position
void clearCursor(int x, int y) {
  int cursorXPos = x * 12;
  int cursorYPos = 20 + y * 12;

  display.fillRect(cursorXPos, cursorYPos, 12, 12, SH110X_BLACK);
  display.setCursor(cursorXPos, cursorYPos);
  display.print(keyboard[y][x]);
}

// Update the cursor visually
void updateCursorPosition(int x, int y) {
  clearCursor(previousX, previousY);
  drawCursor(x, y);
  display.display();
  previousX = x;
  previousY = y;
}

// Handle MPU6050 input to move the cursor or scroll
void handleMPUInput(sensors_event_t a, sensors_event_t g) {
  const float threshold = 3.5;
  static unsigned long lastMoveTime = 0;
  const int moveDelay = 200;

  if (responseDisplayed) {
    // Track if the scrollOffset changes to trigger a display update
    int previousOffset = scrollOffset;

    // Calculate the angle of rotation around the Z-axis
    float angle = atan2(g.gyro.y, g.gyro.x) * 180 / PI;

    if (angle > 15) {
      scrollOffset += 5;
    } else if (angle < -15) {
      scrollOffset -= 5;
    }

    if (scrollOffset != previousOffset) {
      displayAIResponse();
      delay(5);
    }
    return;
  }

  // Handle cursor movement
  if (millis() - lastMoveTime > moveDelay) {
    if (a.acceleration.x > threshold) {
      cursorY++;
      if (cursorY >= 4) cursorY = 3;
    } else if (a.acceleration.x < -threshold) {
      cursorY--;
      if (cursorY < 0) cursorY = 0;
    }
    if (a.acceleration.y > threshold) {
      cursorX--;
      if (cursorX < 0) cursorX = 0;
    } else if (a.acceleration.y < -threshold) {
      cursorX++;
      if (cursorX >= 10) cursorX = 9;
    }

    if (cursorX != previousX || cursorY != previousY) {
      updateCursorPosition(cursorX, cursorY);
      lastMoveTime = millis();
    }
  }
}

// Select the key under the cursor
void selectKey() {
  char selectedKey = keyboard[cursorY][cursorX];
  inputText += selectedKey;

  display.fillRect(0, 0, SCREEN_WIDTH, 16, SH110X_BLACK);
  display.setCursor(0, 0);
  display.print("You: ");
  display.print(inputText);
  display.display();
}

// Handle button presses
void checkButtons() {
  bool selectButtonState = digitalRead(BUTTON_PIN_SELECT);
  bool sendButtonState = digitalRead(BUTTON_PIN_SEND);

  if (responseDisplayed && (selectButtonState == HIGH || sendButtonState == HIGH)) {
    // Clear response if a button is pressed after response is shown
    responseDisplayed = false;
    inputText = "";  
    display.clearDisplay();
    drawKeyboard();
    drawCursor(cursorX, cursorY); 
  }

  if (selectButtonState == HIGH && !buttonHeldSelect) {
    buttonHeldSelect = true;
    selectKey();  
  } else if (selectButtonState == LOW) {
    buttonHeldSelect = false;
  }

  if (sendButtonState == HIGH && !buttonHeldSend) {
    buttonHeldSend = true;
    
    if (inputText.length() > 0) {
      sendToGeminiAPI(inputText);
      inputText = "";  
    }
  } else if (sendButtonState == LOW) {
    buttonHeldSend = false;
  }
}

void setup() {
  Serial.begin(9600);
  pinMode(BUTTON_PIN_SELECT, INPUT_PULLUP);
  pinMode(BUTTON_PIN_SEND, INPUT_PULLUP);

  if (!display.begin(0x3C, true)) {
    Serial.println("Display initialization failed!");
    while (1);
  }

  if (!mpu.begin()) {
    Serial.println("MPU6050 initialization failed!");
    while (1);
  }

  mpu.setAccelerometerRange(MPU6050_RANGE_8_G);
  mpu.setGyroRange(MPU6050_RANGE_500_DEG);
  mpu.setFilterBandwidth(MPU6050_BAND_5_HZ);

  display.setTextSize(1);
  display.setTextColor(SH110X_WHITE);

  initWiFi();
  display.clearDisplay();
  drawKeyboard();
  drawCursor(cursorX, cursorY);
}

void loop() {
  sensors_event_t a, g, temp;
  mpu.getEvent(&a, &g, &temp);

  if (!typingStarted) {
    displayAnimationFrame();
    delay(FRAME_DELAY);

    // Check if the user has pressed any buttons to start typing
    bool selectButtonState = digitalRead(BUTTON_PIN_SELECT);
    bool sendButtonState = digitalRead(BUTTON_PIN_SEND);

    if (selectButtonState == HIGH || sendButtonState == HIGH) {
      typingStarted = true; // Switch to keyboard
      display.clearDisplay();
      drawKeyboard();
      drawCursor(cursorX, cursorY);
    }
  } else {
    handleMPUInput(a, g);
    checkButtons();
    delay(100);
  }
}
